---
title: "Analise dos gastos dos parlamentares"
author: "Rafaelle Amorim"
date: "15 de julho de 2016"
output: html_document
---

```{r global_options, include=TRUE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE, fig.width=12, fig.height=6)
```

---

```{r echo=FALSE}
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
library(maps)
theme_set(theme_bw())

```

Para o checkpoint 4 utilizaremos os dados coletados do site de tranparência da câmara dos deputados. Esses dados são referentes aos gastos dos deputados em 2016 e são compostos por 572 parlamentares. 

```{r}
gastos = read.csv("../dados/ano-atual.csv",  encoding="UTF-8")
cotas = read.csv("../dados/valor-cota-por-estado.csv",  encoding="UTF-8")
```

Inicialmente iremos analisar a categoria de "Emissão Bilhete Aéreo", que diferente da categoria "Passagens Aéreas", possui apenas 
dados de 2016, para tentar responder a pergunta "Como é distribuído a quantidade de pessoas que viajam com o nome dos Deputados?"

Para melhor compreensão dos dados, usaremos apenas os gastos com "valor liquido" positivo, pois os valores negativos significam que o referido bilhete é um bilhete de compensação, pois compensa um outro bilhete emitido e não utilizado pelo deputado.

```{r}

emissao.bilhete.aereo = gastos %>%
  group_by(txtDescricao) %>%
  filter(txtDescricao == "Emissão Bilhete Aéreo" & vlrLiquido >= 0) 
  
summary(emissao.bilhete.aereo$vlrLiquido)

bilhete.aereo.por.deputado = emissao.bilhete.aereo %>%
  group_by(txNomeParlamentar) %>%
  summarise(total.passageiros = length(unique(txtPassageiro)), total.vlrLiquido = sum(vlrLiquido))  %>%
  arrange(-total.passageiros)


#summary(bilhete.aereo.por.deputado$total.passageiros)

```

Tivemos um total de 517 observações,então, para melhor visualização iremos categorizar os deputados em total de passageiros (que voam usando a sua cota)

``` {r}

categorias.passageiros =  bilhete.aereo.por.deputado %>%
  group_by(total.passageiros) %>%
  summarise( quantidade.deputados = length(unique(txNomeParlamentar))) %>%
  arrange(-quantidade.deputados)
  

ggplot(categorias.passageiros , aes( as.factor(quantidade.deputados),total.passageiros)) +
  geom_point() +
  geom_hline(yintercept = mean(categorias.passageiros$total.passageiros), color="red") +
    geom_hline(yintercept = median(categorias.passageiros$total.passageiros), color="blue")

```

Podemos perceber que a média e a mediana são bem parecidas e que se concentram em torno de 14 passageiros por deputado.

Categorizando os deputados, podemos perceber também, que existe uma grande concentração de parlamentares com apenas um passageiro, ou seja, apenas ele viaja.

--------

Agora iremos avaliar o total do gasto liquido de cada deputado em relação a quantidade de passageiros:

```{r}
ggplot(bilhete.aereo.por.deputado, aes(as.factor(total.passageiros), total.vlrLiquido/1e4))+
  geom_point(position = position_jitter(width = .2), alpha = .4)

```









-------------

pergunta 2 -  Quais são os estados que gastam mais? E os que economizam?

Primeiramente, iremos agrupar os deputados por estado, obtendo assim, o valor total gasto por cada estado, a média de gasto, e a cota de cada deputado por estado 
  
```{r}
gasto.por.estado = gastos %>%
  group_by(sgUF) %>%
  summarise(total.gasto = sum(vlrLiquido), media.gasto = mean(vlrLiquido), numDeputados = length(unique(txNomeParlamentar)), valor.por.cota = sum(vlrLiquido/valor))

gasto.por.estado = left_join(gasto.por.estado, cotas, by = c("sgUF" = "estado"))

```

Em um primeiro momento, percebemos que existe o valor NA (not available) nos estados, investigando melhor, descobrimos que são gastos partidarios, portanto, sem estado definido.

Para a análise, não iremos nos atar a esses dados, mas iremos mostrar resumidamente como os dados se comportam:

```{r}
gasto.partidario = gastos %>%
  filter(is.na(sgUF)) %>%
  group_by(txNomeParlamentar, txtDescricao)  %>%
  summarise(total.gasto = sum(vlrLiquido))

ggplot(gasto.partidario, aes(txtDescricao, total.gasto ,fill = txNomeParlamentar)) + 
  geom_bar(stat = "identity" , position = "dodge") + coord_flip()


```


---------

Para tentar melhorar a precisão iremos dividir o total do valor liquido de cada parlamentar por sua cota, assim, teremos um valor que representa o valor/cota. 

```{r}
map("world", "Brazil") 

```

```{r}




ggplot()

```












