---
title: "Problema 4 - checkpoint 1"
output: html_document
---

```{r global_options, include=TRUE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE, fig.width=12, fig.height=6)
```

 

```{r echo=FALSE}
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
#install.packages("resample")
library(resample)
theme_set(theme_bw())

filmes = read.csv("dados/movies.csv",  encoding="UTF-8")
ratings = read.csv("dados/ratings.csv",  encoding="UTF-8")

```

1 - Escolha uma trilogia (ou uma n-logia com n > 3) e avalie para qual dos episódios da trilogia há melhor avaliação e para qual há mais variação nas notas atribuídas ao filme.

Para a primeira parte, iremos escolher a trilogia Senhor dos Anéis.

```{r}

filmes.senhor.dos.aneis = filmes %>%
  filter(grepl('Lord of the Rings', title))

senhor.dos.aneis.ratings = ratings %>%
   filter(movieId %in% filmes.senhor.dos.aneis$movieId) 

head(filmes.senhor.dos.aneis)



```

Na seleção da trilogia, descobrimos um filme inesperado "The Lord of the Rings (1978)", filme americano de 1978, criado e realizado por Ralph Bakshi. A longa metragem é uma adaptação da primeira parte da trilogia "O Senhor dos Anéis"(1954-1955) e foi feita por Peter S. Beagle e Chris Conkling. O filme contém animação e cenas live-action utilizando a técnica rotoscoped para dar-lhe uma aparência mais consistente e real a toda a acção do filme. 


Iremos verificar a quantidade de avaliações que cada filme teve 
```{r}
senhor.dos.aneis.ratings.quant = senhor.dos.aneis.ratings %>%
group_by(movieId) %>%
summarise(quantidade = n())

head(senhor.dos.aneis.ratings.quant)

```

Como podemos verificar, o filme de 1978 possui 19 avaliações, e considerando que não faz parte da trilogia (2001 a 2003), vamos retirá-lo da análise.
E verificaremos a distribuição da amostra.

```{r}
senhor.dos.aneis.ratings = senhor.dos.aneis.ratings %>%
  filter(movieId != 2116)

ggplot(senhor.dos.aneis.ratings, aes(rating)) + 
  geom_bar() + 
  facet_wrap(~movieId, scales = c("free_y")) +
  ggtitle("Distribuição das avaliações da amostra do filme 'Senhor dos Anéis'")
```

A distribuição das avaliações dos usuários é  parecida, concentrando em sua maior parte à direita. E para uma maior representação, decidimos utilizar o intervalo de confiança feito com a média dos valores.


```{r}
#Lord of the Rings: The Fellowship of the Ring, The (2001)
experiment1 = sample_n(filter(senhor.dos.aneis.ratings, movieId == 4993), 1000, replace = TRUE)

bootstrap.media.senhor.dos.aneis1 = bootstrap(experiment1, mean(rating))
media.senhor.dos.aneis1 = CI.bca(bootstrap.media.senhor.dos.aneis1, probs = c(.025, .975))


# Lord of the Rings: The Two Towers, The (2002)
experiment2 = sample_n(filter(senhor.dos.aneis.ratings, movieId == 5952), 1000, replace = TRUE)

bootstrap.media.senhor.dos.aneis2 = bootstrap(experiment2, mean(rating))
media.senhor.dos.aneis2 = CI.bca(bootstrap.media.senhor.dos.aneis2, probs = c(.025, .975))


# Lord of the Rings: The Return of the King, The (2003)
experiment3 = sample_n(filter(senhor.dos.aneis.ratings, movieId == 7153), 1000, replace = TRUE)

bootstrap.media.senhor.dos.aneis3 = bootstrap(experiment3, mean(rating))
media.senhor.dos.aneis3 = CI.percentile(bootstrap.media.senhor.dos.aneis3, probs = c(.025, .975))


medias.senhor.dos.aneis <- data.frame(
  rbind(
    c("SENHOR.DOS.ANEIS1", media.senhor.dos.aneis1),
    c("SENHOR.DOS.ANEIS2", media.senhor.dos.aneis2),
    c("SENHOR.DOS.ANEIS3", media.senhor.dos.aneis3)
  )
)

names(medias.senhor.dos.aneis) = c("titulo", "limite.inferior", "limite.superior")

medias.senhor.dos.aneis %>% 
  ggplot(aes(x = titulo, ymin = limite.inferior, ymax = limite.superior)) + 
  geom_errorbar(width = .2) +
    ggtitle("Intervalo de confiança da estimativa das médias das notas dos filmes de 'Senhor dos Anéis'")

```
Como conclusão à pergunta inicial 'Qual dos episódios da trilogia há melhor avaliação':
  Não podemos inferir com certeza qual o melhor filme da trilogia, visto que o intervalo de confiança da média das avaliações das amostras se sobrepõe. 
  
  
Para a segunda parte da pergunta (quanto a variação das notas), iremos determinar o intervalo de confiança para a variação nas notas atribuídas ao filme. 
  
  
```{r}
#Lord of the Rings: The Fellowship of the Ring, The (2001)

bootstrap.sd.senhor.dos.aneis1 = bootstrap(experiment1, sd(rating))
sd.senhor.dos.aneis1 = CI.bca(bootstrap.sd.senhor.dos.aneis1, probs = c(.025, .975))


# Lord of the Rings: The Two Towers, The (2002)

bootstrap.sd.senhor.dos.aneis2 = bootstrap(experiment2, sd(rating))
sd.senhor.dos.aneis2 = CI.bca(bootstrap.sd.senhor.dos.aneis2, probs = c(.025, .975))


# Lord of the Rings: The Return of the King, The (2003)

bootstrap.sd.senhor.dos.aneis3 = bootstrap(experiment3, sd(rating))
sd.senhor.dos.aneis3 = CI.percentile(bootstrap.sd.senhor.dos.aneis3, probs = c(.025, .975))


sd.senhor.dos.aneis <- data.frame(
  rbind(
    c("SENHOR.DOS.ANEIS1", sd.senhor.dos.aneis1),
    c("SENHOR.DOS.ANEIS2", sd.senhor.dos.aneis2),
    c("SENHOR.DOS.ANEIS3", sd.senhor.dos.aneis3)
  )
)

names(sd.senhor.dos.aneis) = c("titulo", "limite.inferior", "limite.superior")

sd.senhor.dos.aneis %>% 
  ggplot(aes(x = titulo, ymin = limite.inferior, ymax = limite.superior)) + 
  geom_errorbar(width = .2) +
    ggtitle("Intervalo de confiança da estimativa do desvio padrão das notas dos filmes de 'Senhor dos Anéis'")


```


Também não é possível inferir sobre qual o filme possui maior varabilidade.
  
  https://github.com/nazareno/ciencia-de-dados-1/blob/master/4-Inferencia/Inferencia-2.Rmd
  https://github.com/odwl66/ad1/blob/master/problema4/problema4-checkpoint1.Rmd
  https://github.com/arthurlustosa/ad1/blob/master/Problema4/problema4-cp1.Rmd
  https://github.com/monkshorin/ad120161/blob/master/problema4/index.Rmd
  https://github.com/michellymenezes/AD1/blob/master/Prob4/prob4Cp1.Rmd
  https://github.com/jvmafra/AD1/blob/master/problema4-cp1/inferencia.Rmd
  
  
  

