---
title: "Problema 4 - checkpoint 1"
output: html_document
---

```{r global_options, include=TRUE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE, fig.width=12, fig.height=6)
```

 

```{r echo=FALSE}
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
#install.packages("resample")
library(resample)
theme_set(theme_bw())

filmes = read.csv("dados/movies.csv",  encoding="UTF-8")
ratings = read.csv("dados/ratings.csv",  encoding="UTF-8")

```

1 - Escolha uma trilogia (ou uma n-logia com n > 3) e avalie para qual dos episódios da trilogia há melhor avaliação e para qual há mais variação nas notas atribuídas ao filme.

Para a primeira parte, iremos escolher a trilogia Senhor dos Anéis.

```{r}

filmes.senhor.dos.aneis = filmes %>%
  filter(grepl('Lord of the Rings', title))

senhor.dos.aneis.ratings = ratings %>%
   filter(movieId %in% filmes.senhor.dos.aneis$movieId) 

head(filmes.senhor.dos.aneis)



```

Na seleção da trilogia, descobrimos um filme inesperado "The Lord of the Rings (1978)", filme americano de 1978, criado e realizado por Ralph Bakshi. A longa metragem é uma adaptação da primeira parte da trilogia "O Senhor dos Anéis"(1954-1955) e foi feita por Peter S. Beagle e Chris Conkling. O filme contém animação e cenas live-action utilizando a técnica rotoscoped para dar-lhe uma aparência mais consistente e real a toda a acção do filme. 


Iremos verificar a quantidade de avaliações que cada filme teve 
```{r}
senhor.dos.aneis.ratings.quant = senhor.dos.aneis.ratings %>%
group_by(movieId) %>%
summarise(quantidade = n())

head(senhor.dos.aneis.ratings.quant)

```

Como podemos verificar, o filme de 1978 possui 19 avaliações, e considerando que não faz parte da trilogia (2001 a 2003), vamos retira-lo da análise.
E verificaremos a distribuição da amostra

```{r}
senhor.dos.aneis.ratings = senhor.dos.aneis.ratings %>%
  filter(movieId != 2116)

ggplot(senhor.dos.aneis.ratings, aes(rating)) + 
  geom_bar() + 
  facet_wrap(~movieId, scales = c("free_y"))
```

A distribuição das avaliações dos usuários são parecidas, concentrando em sua maior parte à direita. E para uma maior representação, decidimos utilizar o intervalo de confiança feito com a mediana dos valores.



```{r}
#Lord of the Rings: The Fellowship of the Ring, The (2001)
experiment1 = sample_n(filter(senhor.dos.aneis.ratings, movieId == 4993), 1000, replace = TRUE)

bootstrap.mediana.senhor.dos.aneis1 = bootstrap(experiment1, median(rating))
mediana.senhor.dos.aneis1 = CI.percentile(bootstrap.mediana.senhor.dos.aneis1, probs = c(.025, .975))


# Lord of the Rings: The Two Towers, The (2002)
experiment2 = sample_n(filter(senhor.dos.aneis.ratings, movieId == 5952), 1000, replace = TRUE)

bootstrap.mediana.senhor.dos.aneis2 = bootstrap(experiment2, median(rating))
mediana.senhor.dos.aneis2 = CI.percentile(bootstrap.mediana.senhor.dos.aneis2, probs = c(.025, .975))


# Lord of the Rings: The Return of the King, The (2003)

experiment3 = sample_n(filter(senhor.dos.aneis.ratings, movieId == 7153), 1000, replace = TRUE)

bootstrap.mediana.senhor.dos.aneis3 = bootstrap(experiment3, median(rating))
mediana.senhor.dos.aneis3 = CI.percentile(bootstrap.mediana.senhor.dos.aneis3, probs = c(.025, .975))


medianas.senhor.dos.aneis <- data.frame(
  rbind(
    c("SENHOR.DOS.ANEIS1", mediana.senhor.dos.aneis1),
    c("SENHOR.DOS.ANEIS2", mediana.senhor.dos.aneis2),
    c("SENHOR.DOS.ANEIS3", mediana.senhor.dos.aneis3)
  )
)

names(medianas.senhor.dos.aneis) = c("titulo", "limite.inferior", "limite.superior")


```





