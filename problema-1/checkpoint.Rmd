
---
title: "Dados de gastos de parlamentares"
output: html_document
---

```{r global_options, include=TRUE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE, fig.width=12, fig.height=6)
```

```{r echo=FALSE}
#install.packages("dplyr")
#install.packages("ggplot2")
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
theme_set(theme_bw())

```

Dados de gastos dos deputados de um periodo recente e valor das cotas por estado. Os dados sÃ£o compostos por 572 parlamentares. Para o estudo iremos sempre utilizar o valor líquido, que em nossos dados, representa a diferença entre o valor do documento e o valor da Glosa.


```{r}
gastos = read.csv("~/ufcg/AD1/problema-1/ano-atual.csv",  encoding="UTF-8")
cotas = read.csv("~/ufcg/AD1/problema-1/valor-cota-por-estado.csv",  encoding="UTF-8")
```

```{r echo=FALSE}
total.tipo.despesa.geral = gastos %>% 
  group_by(txtDescricao) %>% 
  summarise(total.geral = sum(vlrLiquido), desvioPadrao = sd(vlrLiquido))
```

Os gastos dos parlamentares sÃ£o divididos em 18 tipos de categoria.

Pergunta 2A : Em que tipo de despesas nossos parlamentares gastam mais recursos de sua cota?

Para responder a pergunta proposta, separamos os gastos de cada deputado por categoria de gasto, com isso, podemos selecionar apenas o "Tipo de Gasto" com maior despesa para cada um dos parlamentares.  

```{r}

tipo.maior.despesa.deputado = gastos %>% 
  group_by(txtDescricao, txNomeParlamentar) %>% 
  summarise(total.despesa = sum(vlrLiquido)) %>%
  ungroup(tipo.maior.despesa.deputado) %>%
  group_by(txNomeParlamentar ) %>% 
  filter(total.despesa == max(total.despesa))

```

Agora agruparemos, usando a tabela anteriormente gerada, por "Tipo de Gasto" para obter qual categoria os deputados mais gastam.

```{r}

total.tipo.despesa = tipo.maior.despesa.deputado %>%
  group_by(txtDescricao) %>%
  summarise(total = sum(total.despesa))

grafico.valor.tipo.despesa = ggplot(total.tipo.despesa, aes(x = reorder(txtDescricao, total/1e6),y = total/1e6)) +
  geom_bar(stat = "identity") +
  xlab("Tipo de Gasto") + 
  ylab("Total gasto (milh?es)") +
  ggtitle("Qauntidade de Tipo de Gasto") +
  coord_flip()

grafico.valor.tipo.despesa
         
```

Como podemos observar no grÃ¡fico, os trÃªs "Tipos de Gasto" com maiores custos da cota dos deputados s?o:
  - DivulgaÃ§Ã£o de Atividades Parlamentar;
  - Consultorias, Pesquisa e Trabalhos TÃ©cnicos;
  - EmissÃ£o de Bilhete AÃ©reo.


Pergunta 2B : Quais tipos de despesas tÃªm despesas que mais variam, que tÃªm valores mais desiguais?

Iremos gerar um grÃ¡fico para observar a distribuiÃ§Ã£o dos gastos por categoria. 

```{r}
ggplot(gastos, aes(txtDescricao, vlrLiquido)) + 
  geom_boxplot() + 
  xlab("Tipo de Gasto") + 
  ylab("Valor Liquido") + 
  ggtitle("DistribuiÃ§Ã£o de Gasto por categoria") +
  coord_flip()+
  geom_point(position = position_jitter(width = .2), alpha = .07)

```

Calculando o desvio padrÃ£o dos gastos, para verificar quÃ£o distante os valores estÃ£o da mÃ©dia, temos o seguinte grÃ¡fico:

```{r}

ggplot(total.tipo.despesa.geral, aes(x = reorder(txtDescricao, desvioPadrao), y = desvioPadrao)) + 
  geom_bar(stat = "identity")  + 
  xlab("Tipo de Gasto") + 
  ylab("Desvio PadrÃ£o") +
  ggtitle("Desvio padrÃ£o dos Tipo de Gastos") +
  coord_flip()

```

Como podemos verificar utilizando os dois grÃ¡ficos, "DivulgaÃ§Ã£o de Atividades Parlamentar" e "Consultorias, Pesquisa e Trabalhos TÃ©cnicos" sÃ£o as duas categorias com maior variabilidade, jÃ¡ as categorias "Fornecimento de AlimentaÃ§Ã£o do Parlamentar" e "ServiÃ§o de TÃ¡xi, PedÃ¡gio e Estacionamento" possuiem a menor variaÃ§Ã£o.


Por possuir o maior gasto e a maior variabilidadeInicialmente iremos selecionar apenas a categoria "DivulgaÃ§Ã£o da Atividade Parlamentar" para explorar um pouco mais os dados.

```{r echo=FALSE}
despesa.especifica = gastos %>% 
  filter(txtDescricao == "DIVULGAÇÃO DA ATIVIDADE PARLAMENTAR.")
```

``` {r}
summary(gastos$vlrLiquido)
```

Podemos observar uma grande diferença entre os valores de média e mediana, além disso, a diferença do valor máximo para a média é bastante elevada.



Agora agruparemos por estado o valor das despesas com Divulgação de Atividade Parlamentar.

```{r}
divulgacao.estado = despesa.especifica %>%
  group_by(sgUF)

ggplot(divulgacao.estado, aes(sgUF, vlrLiquido)) + 
  geom_boxplot() + 
  xlab("Estados") + 
  ylab("Valor Liquido") + 
  ggtitle("Distribuição de Divulgação de Atividade Parlamentar por estado") +
  geom_point(position = position_jitter(width = .2), alpha = .07)


total.divulgacao.estado = divulgacao.estado %>%
  group_by(sgUF) %>%
  summarise(total.divulgacao = sum(vlrLiquido), media.estado = mean(vlrLiquido))

ggplot(total.divulgacao.estado, aes(x = reorder(sgUF, total.divulgacao), y = total.divulgacao)) + 
  geom_bar(stat = "identity")  + 
  xlab("Tipo de Gasto") + 
  ylab("Desvio Padrão") +
  ggtitle("Desvio padrão dos Tipo de Gastos") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
  geom_bar(aes(x = reorder(sgUF, total.divulgacao), y=total.divulgacao, fill=media.estado), width=.25,alpha = 0.5, fill="#CC0000")


mx <- mean(x)
hist(x)
abline(v = mx, col = "blue", lwd = 2)


```










